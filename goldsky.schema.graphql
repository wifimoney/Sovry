# GraphQL schema used by Goldsky indexer to power the "Yield/Dividends" feature.
# ------------------------------------------------------------
# Pool entity: tracks liquidity pairs (one token must be WIP)
# Indexed from SovryFactory::PoolCreated(address token0, address token1, address pair)
# ------------------------------------------------------------

type Pool @entity {
  id: ID!
  pairAddress: Bytes!
  factory: Bytes!
  token0: Bytes!
  token1: Bytes!
  reserve0: BigDecimal!
  reserve1: BigDecimal!
  createdAt: BigInt!
}

# ------------------------------------------------------------
# RoyaltyPayment entity: tracks revenue flowing through Story's RoyaltyModule
# Indexed from RoyaltyModule::RevenuePaid(address targetIp, address token, uint256 amount)
# ------------------------------------------------------------

type RoyaltyPayment @entity {
  id: ID!
  targetIp: Bytes!
  token: Bytes!
  amount: BigDecimal!
  transactionHash: Bytes!
  blockNumber: BigInt!
  timestamp: BigInt!
  ipAsset: IPAsset!
}

# ------------------------------------------------------------
# IPAsset entity: registered IPs with linkage to royalty payments
# Indexed from IPRegistry::IPRegistered(address ipAsset, address royaltyVault)
# ------------------------------------------------------------

type IPAsset @entity {
  id: ID!
  owner: Bytes!
  royaltyVault: Bytes!
  createdAt: BigInt!
  royaltyPayments: [RoyaltyPayment!]! @derivedFrom(field: "ipAsset")
}
